# Challenge 5: Deploying to Cloud Run & Monitoring Logs üöÄ‚òÅÔ∏è

## Introduction

You've built a sophisticated RAG application! The final step is to deploy it to the cloud so it can be accessed reliably. In this challenge, you'll deploy your Next.js application, including the Genkit flows, to Google Cloud Run using the provided Makefile and learn how to monitor its logs.

## Step 1: Prerequisites Check ‚úÖ

Before deploying, ensure you have:

1.  **Set up Google Cloud Project:** Your `gcloud` CLI should be configured with your project ID. If not, run:
    ```bash
    gcloud config set project <YOUR_PROJECT_ID>
    ```
    (Replace `<YOUR_PROJECT_ID>` with your actual project ID).
2.  **Authenticated:** You need Application Default Credentials (ADC) set up. If you haven't already, run:
    ```bash
    gcloud auth login
    gcloud auth application-default login
    ```
3.  **Environment Variables:** The application relies on environment variables (like `GCP_PROJECT_ID` used in `src/lib/Firebase/FirebaseConfig.tsx`). Cloud Run deployment via the Makefile *should* handle setting these based on your environment or `terraform.tfvars`, but double-check the `Makefile` and your Cloud Run service configuration after deployment if you encounter issues.

## Step 2: Deploying to Cloud Run using Makefile üõ†Ô∏è

The project includes a `Makefile` designed to simplify the deployment process.

1.  **Examine the Makefile:** Open the `Makefile` in the root directory. Understand the commands it runs.
2.  **Run the Deployment Command:** Execute the deployment target from your terminal:
    ```bash
    make all
    ```
    This command will typically:
    *   Initiate the GCP environment and assure that APIs are enabled
    *   Build a container image for your application using the `Dockerfile`.
    *   Push the image to Google Artifact Registry.
    *   Deploy the image as a new revision to a Cloud Run service.

    Follow any prompts during the deployment process. It might take a few minutes.

## Step 3: Accessing the Deployed Application üåê

Once the deployment is successful, the `gcloud run deploy` command (or the Makefile script) will output the URL of your deployed Cloud Run service.

1.  **Copy the URL:** Get the service URL from the terminal output.
2.  **Test:** Open the URL in your web browser to ensure the application is running correctly. Test the different functionalities (Admin, Search, Query).

## Step 4: Monitoring Production Logs in Cloud Logging üìä

It's crucial to monitor the logs of your deployed application for debugging and understanding its behavior. Genkit and your application code will output logs that are automatically captured by Cloud Run and sent to Cloud Logging (associated with your Firebase/GCP project).

1.  **Navigate to Cloud Logging:**
    *   Go to the [Cloud run in your GCP Console](https://console.cloud.google.com/run).
    *   Explore your newly deployed service. In the Console you can access logs, metrics, versions and many more functionalities.

3.  **Analyze Genkit Traces:**
    *   Traces generated by your Genkit flows are automatically available in your [Firebase Console](https://console.firebase.google.com/). In the left sidebar, you can select "Genkit" in the "AI" section. These are your Genkit production traces.
    *   Send a couple queries into your deployed application. Review the traces popping up in your Firebase production monitoring.

## Next Steps

Congratulations! You've successfully deployed your Genkit-powered RAG application to Cloud Run and learned how to monitor its production logs. This completes the final challenge, giving you a fully functional and deployed AI application.
